
-- BR PART 1
--1.?? ?? ??????? ??????? ?? ??????? ?? ?????? ?????? ? ???????
INSERT INTO BANK_DEPARTMENT(DEPARTMENT_NAME) VALUES ('Human resources');
INSERT INTO BANK_DEPARTMENT(DEPARTMENT_NAME) VALUES('Finance');
INSERT INTO BANK_DEPARTMENT(DEPARTMENT_NAME) VALUES('Economics');
INSERT INTO BANK_DEPARTMENT(DEPARTMENT_NAME) VALUES('Information Technology');

SELECT DEPARTMENT_NAME FROM BANK_DEPARTMENT;

--2. ?? ?? ??????? ???????? ?? ????????? ?????????????? ?? ??????
--?????????, ? ???????? ? ?????????? ?? ?????????? ????? ?????
--?? ????????? ? ???????? ???????

ALTER TABLE BANK_EMPLOYEE
    ADD SALARY FLOAT NOT NULL ENABLE;
    
SELECT FNAME,LNAME,SALARY FROM BANK_EMPLOYEE;

/*
3. ?? ?? ??????? ??????? ?? ?????? ????????? ? ??????? ? ????????
?????? ?? ?????????? ????? ????? ?? ??????????? ? ??????????????
??????, ????? ?? ?? ??????? ?? ????????????? ??????? ? ????? ???
?? ????????? ????????? ? ?????. ??????? ?? ??????????? ?????? ??
????? ? ????? ????? ? ??????. ??????? ?? ?????????? ? bankoftomarow.bg
*/
INSERT INTO BANK_EMPLOYEE(FNAME,LNAME,MNAME,ADDRESS,PHONE_NUMBER,EMAIL,EMP_ROLE,DEPARTMENT_ID,SALARY)
                    VALUES('Sime','Yankulov','Hristov','bul.Bulgaria 236B','+123123123','jankulov.sime@yahoo.com','support',1,20000);
INSERT INTO BANK_EMPLOYEE(FNAME,LNAME,MNAME,ADDRESS,PHONE_NUMBER,EMAIL,EMP_ROLE,DEPARTMENT_ID,SALARY)
                    VALUES('Ivan','Ivanov','Ivanov','bul.Bulgaria 236B','+123123124','ivanivanov@yahoo.com','idk',1,2000);
INSERT INTO BANK_EMPLOYEE(FNAME,LNAME,MNAME,ADDRESS,PHONE_NUMBER,EMAIL,EMP_ROLE,DEPARTMENT_ID,SALARY)
                    VALUES('Petar','Petarov','petarov','bul.Bulgaria 236B','+123123125','petarpetar@yahoo.com','idk',2,1700);
                    
COMMIT;

SELECT FNAME,LNAME, LOWER(FNAME) || '.' || LOWER(LNAME) || '@bankoftomarow.bg' AS EMAIL from BANK_EMPLOYEE;

/*4. ???????? ?????? ????????? ????? ??????? ???????? ???? ??????
?????????. ?????? ????????? ?? ?????? ????? ??????? ? ??????????
?? 5 ??????*/

ALTER TABLE BANK_EMPLOYEE
DROP COLUMN EMPLOYMENT_DATE;
ALTER TABLE BANK_EMPLOYEE
    ADD EMPLOYMENT_DATE DATE;

update BANK_EMPLOYEE
set EMPLOYMENT_DATE = TO_DATE('2015/01/01','YYYY/MM/DD')
WHERE EMPLOYEE_ID = 3;

SELECT FNAME,LNAME,EMPLOYMENT_DATE FROM BANK_EMPLOYEE 
WHERE TRUNC(MONTHS_BETWEEN(SYSDATE, EMPLOYMENT_DATE) / 12) > = 5;
 
/*5. ???????? ?????? ?????????, ????? ????? (????? / ????? ???
???????????? ???????? ??????? l)
*/
SELECT FNAME,LNAME FROM BANK_EMPLOYEE
WHERE INSTR(LOWER(FNAME),'l') > 0 OR INSTR(LOWER(LNAME),'l') > 0;

-- BR PART 2

CREATE TABLE BANK_EMPLOYEE_MIGRATION(
    MIGRATION_ID      NUMBER GENERATED AS IDENTITY,
    EMPLOYEE_ID       NUMBER NOT NULL ENABLE,   
    OLD_DEPARTMENT_ID NUMBER NOT NULL ENABLE,
    NEW_DEPARTMENT_ID NUMBER NOT NULL ENABLE,
    MIGRATION_DATE    DATE NOT NULL ENABLE,
    
    CONSTRAINT FK_EMPLOYEE FOREIGN KEY(EMPLOYEE_ID)
    REFERENCES BANK_EMPLOYEE(EMPLOYEE_ID),
    CONSTRAINT FK_OLD_DEPARTMENT FOREIGN KEY(OLD_DEPARTMENT_ID)
    REFERENCES BANK_DEPARTMENT(DEPARTMENT_ID),
    CONSTRAINT FK_NEW_DEPARTMENT FOREIGN KEY(NEW_DEPARTMENT_ID)
    REFERENCES BANK_DEPARTMENT(DEPARTMENT_ID),
    PRIMARY KEY(MIGRATION_ID)
);

select * from bank_department ;
select * from bank_employee;

--1. ?? ?? ?????????? ???????? inserta ? ???? ???????
INSERT INTO BANK_EMPLOYEE_MIGRATION(EMPLOYEE_ID,OLD_DEPARTMENT_ID,NEW_DEPARTMENT_ID,MIGRATION_DATE)
    VALUES(3,1,2,TO_DATE('2022/01/01','YYYY/MM/DD'));

INSERT INTO BANK_EMPLOYEE_MIGRATION(EMPLOYEE_ID,OLD_DEPARTMENT_ID,NEW_DEPARTMENT_ID,MIGRATION_DATE)
    VALUES(3,2,3,TO_DATE('2024/02/26','YYYY/MM/DD'));

COMMIT;

update BANK_EMPLOYEE
set DEPARTMENT_ID = 3
WHERE EMPLOYEE_ID = 3;  
    
SELECT * FROM BANK_EMPLOYEE_MIGRATION;

/*2. ?? ?? ????????? ??????? ?? ???????????, ????? ?? ???????? ? ??????
?? ???? ????? ? ??????? ?? ?????????? ??? ??????
*/
    SELECT FNAME,LNAME FROM BANK_EMPLOYEE 
    WHERE EMPLOYEE_ID IN 
    (SELECT EMPLOYEE_ID FROM BANK_EMPLOYEE_MIGRATION
    WHERE MONTHS_BETWEEN(SYSDATE,MIGRATION_DATE)<2);
    
    select employee.fname,employee.lname from bank_employee employee
    join bank_employee_migration  migrationn
    on employee.employee_id=migrationn.employee_id
    where Months_Between(sysdate,migrationn.migration_date)<2;
      
--3.. ?? ?? ????????? ??????? ?? ??????????? ????? ?? ???????? ???? ?
--???? ????? ??????? ?? ???? ?? ??????????? ?? ??????????

SELECT FNAME,LNAME FROM BANK_EMPLOYEE
    WHERE (EMPLOYEE_ID NOT IN (SELECT EMPLOYEE_ID FROM BANK_EMPLOYEE_MIGRATION));

--PART 3

ALTER TABLE BANK_EMPLOYEE
ADD STATUS VARCHAR2(15)

update BANK_EMPLOYEE
set STATUS = 'fired'
WHERE EMPLOYEE_ID = 3; 

commit;

select* from bank_employee;

/*1. ?? ?? ????????? ??????? ???????? ?????? ????????? ????? ?? ????
???????? ?? ??????????*/
SELECT * FROM BANK_EMPLOYEE 
WHERE STATUS = 'fired';

/*2. ?? ?? ????????? ??????? ?? ?????? ????????? ????? ?? ? ??????????
? ???????.*/

SELECT * FROM BANK_EMPLOYEE
WHERE STATUS = 'maternity'

/*3. ?? ?? ????????? ??????? ?? ?????? ????????? ????? ?? ? ???????
/ ???????? ? ???????*/
SELECT * FROM BANK_EMPLOYEE
WHERE STATUS = 'holiday' OR STATUS = 'hospital';

--4. ???????? ?????? ????????? ????? ????? ???????????
SELECT * FROM BANK_EMPLOYEE
WHERE MANAGER_ID IS NULL;

/*5. ???????? ?????? ?????? ????????? ????? ????????? ??????? ?? ??????
?? 5000 ??. ????????? ?? ? ??????? ??????? ???, ???? ?? ??? ???????
??????? ????? ???.*/
SELECT FNAME,LNAME FROM BANK_EMPLOYEE 
WHERE TRUNC(MONTHS_BETWEEN(SYSDATE, EMPLOYMENT_DATE) / 12) > = 5 AND SALARY > 5000
ORDER BY FNAME DESC;

/*6. ???????? ???????? ???-????????????? ????????? ??? ????? ?????.
?????????? ?? ?? ??????.*/
INSERT INTO BANK_EMPLOYEE(FNAME,LNAME,MNAME,ADDRESS,PHONE_NUMBER,EMAIL,EMP_ROLE,DEPARTMENT_ID,SALARY)
                    VALUES('Vasko','Trajkov','Trajkov','bul.Bulgaria 236B','+123123126','vaskotrajkov@yahoo.com','idk',1,1900);
 INSERT INTO BANK_EMPLOYEE(FNAME,LNAME,MNAME,ADDRESS,PHONE_NUMBER,EMAIL,EMP_ROLE,DEPARTMENT_ID,SALARY)
                    VALUES('Mitko','Dimitrov','Dimitrov','bul.Bulgaria 236B','+123123127','ddimitrov@yahoo.com','idk',1,1950);   
 INSERT INTO BANK_EMPLOYEE(FNAME,LNAME,MNAME,ADDRESS,PHONE_NUMBER,EMAIL,EMP_ROLE,DEPARTMENT_ID,SALARY)
                    VALUES('vasil','trajkov','Dimitrov','bul.Bulgaria 236B','+123123129','vasil@yahoo.com','idk',1,2100);

    select e.employee_id, e.department_id, e.salary
    from bank_employee e
    where e.employee_id in (
        select e2.employee_id
        from bank_employee e2
        where e2.department_id=e.department_id
        order by e2.salary desc
        fetch first 5 rows only
    )
    order by department_id,salary desc;
    
    
    update BANK_EMPLOYEE
set salary = 1241241
WHERE EMPLOYEE_ID = 5; 
commit;

/*7. ???????? ?????? ??? ????????, ? ????? / ????? ???????????
??????? ????????? ???-????? ???????.*/

SELECT * 
    FROM(
        SELECT DEPARTMENT_ID,SUM(SALARY) AS SALARY_SUM
        FROM BANK_EMPLOYEE
        GROUP BY DEPARTMENT_ID
        ORDER BY SALARY_SUM ASC
        )
WHERE ROWNUM <= 1;

     SELECT DEPARTMENT_ID,SUM(SALARY) AS SALARY_SUM
        FROM BANK_EMPLOYEE
        GROUP BY DEPARTMENT_ID
        ORDER BY SALARY_SUM ASC
        FETCH FIRST 1 ROWS ONLY;

/*8.???????? ???????? ??????? ??? ????? ?????, ?????????? ?? ????? ?
????????? ???????? ???????*/
SELECT DEPARTMENT_ID,AVG(SALARY) AS AVERAGE_SALARY FROM BANK_EMPLOYEE
GROUP BY DEPARTMENT_ID
ORDER BY DEPARTMENT_ID;

--PART  4
INSERT INTO BANK_CUSTOMER(FNAME,LNAME,ADDRESS,PHONE_NUMBER,EMAIL)
    VALUES('Peter','Parker','example address','+11111111','peterparker@idk.com');
INSERT INTO BANK_CUSTOMER(FNAME,LNAME,ADDRESS,PHONE_NUMBER,EMAIL)
    VALUES('Tomas','Shelby','peakyblinders str.','+222222','tomasshelby@pb.com');
    
SELECT * FROM BANK_CUSTOMER;
INSERT INTO BANK_ACCOUNT(B_ACCOUNT,BALANCE,CURRENCY,CUSTOMER_ID)
    VALUES('PeterParkerBankAccount','0','BGN',1)
INSERT INTO BANK_ACCOUNT(B_ACCOUNT,BALANCE,CURRENCY,CUSTOMER_ID)
    VALUES('TomasShelbyBankAccount','1000','GBP',2)

SELECT * FROM BANK_ACCOUNT;
COMMIT;

/*1. ?? ?? ??????? ?????? ??????? ????? ???? ?????? ??? ??????. ( ????????
?? BGN )*/

SELECT * FROM BANK_CUSTOMER 
WHERE CUSTOMER_ID IN (SELECT CUSTOMER_ID FROM BANK_ACCOUNT WHERE CURRENCY <> 'BGN')

/*2. ?? ?? ??????? ?????? ??????? ????? ???? ?????? ? ?????? ???????
?????. ??????? ??????.*/

SELECT * FROM BANK_CUSTOMER
WHERE CUSTOMER_ID IN (SELECT CUSTOMER_ID FROM BANK_ACCOUNT WHERE BALANCE = 0)

/*3. ?? ?? ?????? ???????? ?? ???????? ?? ????? ??????. ?????????? ??
???????? ??, ? ????? ?? ??????? ?????????? ?? ?????? ?????? ?
???????? ?? ????????. ?????????????? ?????? ???????.*/

ALTER TABLE BANK_ACCOUNT 
ADD TITLE VARCHAR2(50);

SELECT * FROM BANK_ACCOUNT

UPDATE BANK_ACCOUNT
SET TITLE = 
(SELECT FNAME|| ' account '|| CURRENCY FROM BANK_CUSTOMER 
WHERE BANK_ACCOUNT.CUSTOMER_ID = CUSTOMER_ID);

COMMIT;_



    
 
